<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MQTT-Now: MQTT structure</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MQTT-Now
   </div>
   <div id="projectbrief">The fusion of ESP-Now and MQTT</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('da/d82/md_lib_mqtt_now_docs_mqtt.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">MQTT structure </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The MQTT communication with <a href="https://www.home-assistant.io">Home Assistant</a> (or any other application communicating with this network) goes over a couple of topics. These topics are subtopics of one root topic. </p><pre class="fragment">Root -+- \CMD -+-
      |        |--- node1
      |        |--- node2
      |
      |--- \stat -+--- \LWT
      |           |--- \state
      |           |--- node1 -+--- \LWT
      |           |           |--- \state
      |           |--- node2 -+--- \LWT
      |                       |--- \state
      |
      |--- \discovery -+-
                       |--- node1
                       |--- node2
</pre><p> All topics should have the <code>Retained</code> flag set to make sure a node can return to the last known correct state after reconnect or power cycle.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Root topic</h2>
<p >The root topic is where all other communication is organized. The root topic itself contains no payload, only subtopics. General subtopics are a command topic and a status topic. <code>LWT</code> information is contained in the status topic, and shows wether or not the whole network is online. In other words, if the controller is connected to the MQTT broker. It can be either <code>online</code> or <code>offline</code>. A third mandatory (sub)topic is the Discovery topic. This topic holds all information needed for any client to identify all nodes and their abilities. It can also be used to add a node to a client automatically if it joins an MQTTNow network.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Discovery topic</h2>
<p ><code>\discovery</code></p>
<p >The discovery topic can be used to automatically add nodes to 3rd party controlling software like <a href="https://www.home-assistant.io">Home Assistant</a>. Since the main idea of this project is to create a new protocol to be used by Home Assistant please refer to <a href="https://www.home-assistant.io/docs/mqtt/discovery">HASS MQTT Discovery</a> for the exact registration payload. This (sub)topic can be configured without the prepending slash (/). This is usefull if the client has his own discovery topic, like Home Asisstant. In that case the discovery topic should be configured like <code>homeassistant</code>.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Command topic</h2>
<p ><code>\CMD</code></p>
<p >The command topic can be used to send commands to the network as a whole. This can be something like ... This is typically set by 3rd party software. This topic also contains a subtopic for each node, identified by the node-id (see Node Command Topic). <br  />
 The controller subscribes to this topic to receive commands for either the whole network or for a specific node.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Status topic</h2>
<p ><code>\stat</code></p>
<p >The Status topic is used by the controller to publish network status. It shows its online status in the <code>\LWT</code> subtopic and other information like controller name, network status information, IP address etc. For each node (and meaybe even for the controller itself if it also has a node role) there is a subtopic containing status information for that node.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Node Command topic</h2>
<p ><code>\CMD\&lt;node-id&gt;</code></p>
<p >Any device that wants to control a specific node, can publish a message to the node command topic. The full topic will be <code>root-topic\CMD\&lt;node-id&gt;</code>. What these commands can be is made available by the node.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Node Status topic</h2>
<p ><code>\stat\&lt;node-id&gt;</code></p>
<p >The node status topic is used as feedback to the controller. The controller can see if the last command was successfully executed. Also, because it has the 'retained' flag set, the node can check what the last know status was in case of a powercycle or reconnect and go back to that state. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
