<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MQTT-Now: ESP-Now - Messages</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MQTT-Now
   </div>
   <div id="projectbrief">The fusion of ESP-Now and MQTT</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d1/dc6/md_lib_mqtt_now_docs_espnowcomms.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">ESP-Now - Messages </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >ESP-Now supports messages with a maximum payload of 250 bytes. Therefore we have to be very careful with default meta data to make sure enough room is left for actual data. The only default metadata send with each message is the message type. Initial plan was to use a four character code to make it human readable, but that is replaced with a single one byte (<code>int8</code>) code. The Four character code is used as enumeration in the sourcecode. <br  />
 All <code>char[x]</code> fields <b>may</b> be shortened using a NULL termination. If no NULL byte occurs, the full length is used.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Introduction message</h2>
<p >(<code>intr - 1</code>)</p>
<p >The Introdction message is send when a node is powered up. It kinda says "Hello everybody. My name is John, this is what I do and who is the boss?". The message contains the following data:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">name   </th><th class="markdownTableHeadNone">type   </th><th class="markdownTableHeadNone">data   </th><th class="markdownTableHeadNone">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Message type   </td><td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Code for messagetype    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">MAC address   </td><td class="markdownTableBodyNone">byte[6]   </td><td class="markdownTableBodyNone">A1:B2:C3:D4:E5:F6   </td><td class="markdownTableBodyNone">MAC address if this node    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Network UUID   </td><td class="markdownTableBodyNone">byte[16]   </td><td class="markdownTableBodyNone">3d0bb7a9-f3e3-4fa5-86b7-b5f0aeca41ad   </td><td class="markdownTableBodyNone">See <a href="../../../README.md#network-id">Network ID</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Category   </td><td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">See <a href="../../../README.md#node-category">Node category</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Timeout   </td><td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">10   </td><td class="markdownTableBodyNone">Minutes before dead    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Friendly name   </td><td class="markdownTableBodyNone">char[30]   </td><td class="markdownTableBodyNone">"light livingroom"   </td><td class="markdownTableBodyNone">Descriptive name   </td></tr>
</table>
<pre class="fragment"> t
 y                  C
 p         Network  a
 e  MAC      UUID   t  Friendly name
|-|------|---~~~---|--|-----~~~-----|
 0  1-7    8-33     34   35-65 
(total 66 bytes)
</pre><ul>
<li><b>Message type</b>: Enumerated type of message being send. <code>1</code></li>
<li><b>MAC Address</b>: MAC address of node sending this message. Used as unique identifier of the node.</li>
<li><b>Network UUID</b>: The unique ID of the network the node wants to connect to. Must be the same for all members of the network.</li>
<li><b>Category</b>: Identifies the kind of node and its capabilities. In HA this is used to determine the device type.</li>
<li><b>Timeout</b>: Tells the controller when to mark this node dead. If there is no communication coming from this node for x minutes, the node is considered dead.</li>
<li><b>Friendly name</b>: How to call this node in the human interface to easely identify it. For example 'light livingroom'.</li>
</ul>
<h2><a class="anchor" id="autotoc_md2"></a>
Welcome message</h2>
<p >(<code>welc - 2</code>)</p>
<p >The Welcome message is the response of the controller to an Introduction message. Is basically says "Hi John, welcome. I'll write you down as a new member if this network, and from now on you only talk to me."</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">name   </th><th class="markdownTableHeadNone">type   </th><th class="markdownTableHeadNone">data   </th><th class="markdownTableHeadNone">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Message type   </td><td class="markdownTableBodyNone">int8   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Code for messagetype    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">MAC address   </td><td class="markdownTableBodyNone">byte[6]   </td><td class="markdownTableBodyNone">A1:B2:C3:D4:E5:F6   </td><td class="markdownTableBodyNone">Mac address of the controller   </td></tr>
</table>
<pre class="fragment"> t
 y        
 p        
 e  MAC   
|-|------|
 0  1-7   
(total 8 bytes)
</pre> <h2><a class="anchor" id="autotoc_md3"></a>
Request config message</h2>
<p >(<code>rqcf - 3</code>)</p>
<p >When a new node has become a member of a network (eg, the controller has responded to the Introduction Message with a Welcome message), the node can ask for configuration data. This data is needed if this node wants to be a backup controller node (see <a href="../../../README.md#controller-selection">Controller Selection</a>) in case the current controller goes down or loses wifi connectivity.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">name   </th><th class="markdownTableHeadNone">type   </th><th class="markdownTableHeadNone">data   </th><th class="markdownTableHeadNone">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Message type   </td><td class="markdownTableBodyNone">int8   </td><td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">Code for messagetype   </td></tr>
</table>
<pre class="fragment"> t
 y        
 p        
 e  
|-|
 0 
(total 1 byte)
</pre> <h2><a class="anchor" id="autotoc_md4"></a>
Configuration message</h2>
<p >(<code>cnfg - 4</code>)</p>
<p >The response to the Request Config Message. This message contains all data that is needed to take over the role of controller. Being wifi and mqtt credentials.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">name   </th><th class="markdownTableHeadNone">type   </th><th class="markdownTableHeadNone">data   </th><th class="markdownTableHeadNone">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Message type   </td><td class="markdownTableBodyNone">int8   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">Code for messagetype    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">WiFi SSID   </td><td class="markdownTableBodyNone">char[32]   </td><td class="markdownTableBodyNone">My-wifi   </td><td class="markdownTableBodyNone">SSID of your network    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">WiFi Key   </td><td class="markdownTableBodyNone">char[64]   </td><td class="markdownTableBodyNone">*****   </td><td class="markdownTableBodyNone">Authorization key for network    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">IP MQTT broker   </td><td class="markdownTableBodyNone">byte[6]   </td><td class="markdownTableBodyNone">A1:B2:C3:D4:E5:F6   </td><td class="markdownTableBodyNone">IP address of MQTT broker    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MQTT port   </td><td class="markdownTableBodyNone">int16   </td><td class="markdownTableBodyNone">1883   </td><td class="markdownTableBodyNone">Port of MQTT broker    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">MQTT user   </td><td class="markdownTableBodyNone">char[20]   </td><td class="markdownTableBodyNone">user   </td><td class="markdownTableBodyNone">MQTT user (blank if none)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MQTT password   </td><td class="markdownTableBodyNone">char[20]   </td><td class="markdownTableBodyNone">*****   </td><td class="markdownTableBodyNone">MQTT password (blank if none)   </td></tr>
</table>
<pre class="fragment"> t                           P
 y                           o
 p                           r   MQTT    MQTT
 e  SSID   Key     IP MQTT   t   user    pwd
|-|------|--~~~--|---------|---|--~~~--|--~~~--|
 0  1-32   33-96   97-102   103 105-125 126-146
                             -
                            104
(total 147 bytes)
</pre> <h2><a class="anchor" id="autotoc_md5"></a>
Data message</h2>
<p >(<code>data - 5</code>)</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">name   </th><th class="markdownTableHeadNone">type   </th><th class="markdownTableHeadNone">data   </th><th class="markdownTableHeadNone">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Message type   </td><td class="markdownTableBodyNone">int8   </td><td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">Code for messagetype    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Data type   </td><td class="markdownTableBodyNone">int8   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Code to describe type of data    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Data   </td><td class="markdownTableBodyNone">char[240]   </td><td class="markdownTableBodyNone">whatever   </td><td class="markdownTableBodyNone">The data itself   </td></tr>
</table>
<pre class="fragment"> M D
 t t         
 y y         
 p p         
 e e  Data   
|-|-|--~~~--|
 0 1  2-241 

(total 242 bytes)
</pre> <h2><a class="anchor" id="autotoc_md6"></a>
Error message</h2>
<p >(<code>eror - 6</code>)</p>
<p >Is send as a response if an error occurs as a result of a request. For example when a node tries to join a network with an invalid network uuid.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">name   </th><th class="markdownTableHeadNone">type   </th><th class="markdownTableHeadNone">data   </th><th class="markdownTableHeadNone">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Message type   </td><td class="markdownTableBodyNone">int8   </td><td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">Code for messagetype    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Error code   </td><td class="markdownTableBodyNone">int8   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Error code    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Error message   </td><td class="markdownTableBodyNone">char[240]   </td><td class="markdownTableBodyNone">whatever   </td><td class="markdownTableBodyNone">The error message   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
